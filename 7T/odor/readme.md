# 7T experiment for odor representation

## analyze_timing.m
Generate timing files for each run and a file including all runs.

## analyze_rating.m
Analyze ratings for four odors.

## generate_img.tcsh
Convert DICOM files.

## generate_roi.tcsh
Generate ROI masks (iszero(a-roi_label)) and resample to fit functional images.

## phy.tcsh
Generate parameters for physiology correction.

## proc_anatomy.tcsh
Use `@SSwarper` to preprocessing anatomical image, then do recon (resample to 1mm by default) to show data on surface (SUMA).
Only for testing, because high resolution results will be used.
## proc_anatomy_hires.tcsh
Use `@SSwarper` to preprocessing anatomical image, then do recon (keep 0.7mm) to show data on surface (SUMA).
Amygdala can be automatically segmented to 9 nucleis by command `segmentHA_T1.sh`, and `3dAllineate` to EPI grid.
## proc_anatomy_hires.tcsh
Use `@SSwarper` to preprocessing anatomical image, then align it to EPI and do recon (keep 0.7mm) to show data on surface (SUMA).
It may improve accuracy (avoid transformation) after align to EPI.
## proc_fmri.tcsh
Use afni_proc.py to do preprocessing and deconvolve for all runs (one beta one conditon).

## proc_fmri2xsmooth.tcsh
Use `afni_proc.py` to do preprocessing and deconvolve for all runs (one beta one conditon, adding valence and intensity rating as regressors). Set to 2.2mm smooth.

## change_label.tcsh
Change labels in stats file because of a mistake in pro_fmri.tcsh leads to wrong label for a regressor.

## sepmotion.tcsh
Seperate motion files for deconvolve each run.

# Deconvolution
## deconvolve_noblur_rating_odor_TENT.tcsh
Use `TENT(0,10,11)` function to do deconvolution.(${filedec}=odorVI_noblur)

## deconvolve_noblur_rating_odor.tcsh
Deconvole with the same regressors as rating_odor, but use the data without blur and scale. Then, subtract fits of no interest from the original data to obtain clean data.(${filedec}=odorVI_noblur)

## deconvolve_rating_odor.tcsh
Add valence and intensity ratings to regressors, including regressors for odors.(${filedec}=odorVI)

## deconvolve_rating.tcsh
Add valence and intensity ratings to regressors.(${filedec}=VI)

## deconvolve_run.tcsh
Deconvolve for each run (one beta one conditon in each run).(${filedec}=Run)

## deconvolve_trial.tcsh
Deconvolve for all runs but get betas for each trial (one beta one trial in one brick).(${filedec}=IM)

## parallelproc.tcsh
Parallel processing for deconvolving each run.

# Biopac respiration
Analysis that use respiration from Biopac has been done by changing each file listed above (paphde to pabiode). Use files listed below to generate respiration that used in physiology correction and then do the same analysis above.

## marker_trans_7T.m
Tranlate markers in acq file. Used by resp_campare.m.

## resp_campare.m
Load and resample respiration from Biopac (variable: data) and cut it to fit scan time by markers. Then load respiration record by scanner (variable: phy), calculate correalation and save to a mat file.

## resp_align.m
Use ft_preproc_lowpassfilter to filt respiration from Biopac. Align and compare two respiration to a point that has max correalation.

## resp_savebio.m
Save respiration from Biopac to 1d file that used in physiology correction.

## nophy
Analysis same as above but without physioloy correction (pade). This can be a backup for all of the analysis.

# MVPA

## RSA
Representation similarity analysis.

## MVPA_run
Decoding odors using betas for each run.

## MVPA_tial
Decoding odors using betas for each trial.

## MVPA_cleandata
Decoding odors using clean data generated by subtracting fits of no interest.

* Baseline
* Motion
* Rating

## display_results.m
Display results for ROI based mvpa analysis.

## results.Rmd
Results for piriform and amygdala.
## results_Amy.Rmd
Results for different regions of amygdala.

## results_labels.Rmd
Analyze true labels and predicted labels, which can obtain accuracy and confusion matrices for each run.
