# 7T experiment for odor representation

## gendata.m
Gernerate data files, including images, timing files, and phy files.

## order_data.tcsh
Make folders and move files.

## analyze_timing.m
Generate timing files for each run and a file including all runs.

## analyze_timing_valence.m
Generate timing files for every odor valence (amplitude modulated).

## analyze_timing_valence_avg.m
Generate timing files that contain averaged odor valence for each run (amplitude modulated).

## analyze_timing_valence_allavg.m
Generate timing files that contain averaged odor valence (amplitude modulated).

## analyze_timing_rating.m
Generate timing files for the presentation of cue words.

## analyze_rating.m
Analyze ratings for four odors.

## bottlerate.m
Analyze ratings for odors presented by bottles.

## mrirate.m
Analyze ratings for odors presented by the olfactometer.

## mrirate_quick.m
Quickly review ratings in the scanner.

## saverate.m
Save ratings to mat file.

## generate_img.tcsh
Convert DICOM files.

## generate_roi.tcsh
Generate ROI masks (iszero(a-roi_label)) and resample to fit functional images.

## phy.tcsh
Generate parameters for physiology correction.

## prodata.m
Generate proc files for each subject by running `afni_proc.py` and command files for parallel analysis.

## proc_anatomy_hires.tcsh
Use `@SSwarper` to preprocessing anatomical image, then do recon (keep 0.7mm) to show data on surface (SUMA).
Amygdala can be automatically segmented to 9 nucleis by command `segmentHA_T1.sh`, and `3dAllineate` to EPI grid.

## proc_anatomy_alignUACepi.tcsh
Use `@SSwarper` to preprocessing anatomical image, then align it to EPI and do recon (keep 0.7mm) to show data on surface (SUMA).
It may improve accuracy (avoid transformation) after align to EPI.

## proc_anatomy_alignUACepi_e2a.tcsh
Use anatQQ (skull-stripped and normalized image) to do recon-all and generate masks.

## proc_fmri2xsmooth_censor.tcsh
Use `afni_proc.py` to do preprocessing and deconvolve for all runs (one beta one conditon, adding valence and intensity rating as regressors). Set to 2.2mm smooth. Add odor_va regressor and censor motions.

## proc_fmri2xsmooth_censor_e2a.tcsh
Same as `proc_fmri2xsmooth_censor.tcsh` but align EPI to anatomy.

## sepmotion.tcsh
Seperate motion files for deconvolve each run.

# Deconvolution

## deconvolve_censor_odor.tcsh
Only odor and time modulated regressors (for activation mask).

## deconvolve_censor_odor_TENT.tcsh
Use TENT function to deconvolve odors (for time course).

## deconvolve_censor_odorva.tcsh
Amplitude modulated rating regressors but no odor regressor (for clean data).

## deconvolve_censor_odorva_e2a.tcsh
Amplitude modulated rating regressors but no odor regressor in the standard space (for clean data).

## deconvolve_REML.tcsh
Use REML to deconvolve odors after `deconvolve_censor_odor.tcsh`.

## parallelproc.tcsh
Parallel processing for deconvolving each run.

# Biopac respiration
Analysis that use respiration from Biopac has been done by changing each file listed above (paphde to pabiode). Use files listed below to generate respiration that used in physiology correction and then do the same analysis above.

## marker_trans_7T.m
Tranlate markers in acq file. Used by resp_campare.m.

## resp_campare.m
Load and resample respiration from Biopac (variable: data) and cut it to fit scan time by markers. Then load respiration record by scanner (variable: phy), calculate correalation and save to a mat file.

## resp_align.m
Use ft_preproc_lowpassfilter to filt respiration from Biopac. Align and compare two respiration to a point that has max correalation.

## resp_savebio.m
Save respiration from Biopac to 1d file that used in physiology correction.

# group level analysis

## group_level.tcsh
Genereate group level rois.

## group_analysis.bash
Group level analysis by 3dttest++ and dump results to txt files.

# MVPA

## RSA
Representation similarity analysis.

## MVPA_run
Decoding odors using betas for each run.

## MVPA_tial
Decoding odors using betas for each trial.

## MVPA_cleandata
Decoding odors using clean data generated by subtracting fits of no interest.

* Baseline
* Motion
* Rating

## display_results.m
Display results for ROI based mvpa analysis.

# nophy
Analysis same as above but without physioloy correction (pade). This can be a backup for all of the analysis.

# motion
Compare different methods that deal with head movement in the 5th run of S01.

# 5odor
R scripts to show results of 5 odors experiment.

# 4odor
R scripts to show results of 4 odors experiment.

# glm
Generate data and try to understand GLM and MVPA.