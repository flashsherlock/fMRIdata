# analyze iEEG data

## electrodes reconstruction
Several scripts are needed.
* proc_MRI
* recon_all
* proc_CT (use spm to reorient CT image)
* proc_CT_T1 (fusion with MRI and T1.mgz)
* load electrode names from header and edit them in excel
* proc_electrode (proc_elecposition and proc_elecname are used in this script)

## data transformation
Run `raw2mat` to change reference electrodes.
Edit `nc_trialdel` to delete trials and then use `nc_trialfun` to identify markers.

# programms

## generate_img.tcsh
Convert DICOM files to nii.

## raw2mat.m
Convert edf file to mat format.

## raw2mat_s01.m
A function that handles two files for subject1.

## biref.m
Convert to bipolar reference.

## s02_remove.m
Remove some channels in s02 after converting to bipolar reference be

## cutmat.m
Cut whole data into trials and convert eposition to elec.

## trialdel.m
Delete some parts of the data that contain incomplete markers.

## nc_trialfun.m
Find and convert trial markers into a matrix (trl).
trl=[start stop offset label];

## nc_blockfun.m
Find and convert block markers into a matrix (trl).

## nc_trialcut.m
Cut data by the matrix trl and numbers of timepoints before(-)/after(+) trial start and trial end.

## plotmarker.m
Only for test.

## nc_prepare_elec.m
Conver information in eposition field to elec field used by frieldtrip.

# Electrodes localization

## proc_mri.m
Align MRI image to acpc.

## proc_ct.m
Align CT image and fuse it with MRI image.

## recon-all.m
Perform reconstruction in freesurfer.

## proc_ct_T1.m
Align CT with T1.mgz generated by freesurfer.

## proc_electrode.m
Find electrode positions, save to SubjID_elec_acpc_f.mat. Then registrate it to a MNI template and save converted positions to SubjID_elec_mni_fv.mat.

## proc_elecposition.m
Lookup electode positions in a atlas and save the results to SubjID_elec_mni_fv.mat in the field 'position'.

## proc_elecname.m
Generate a cell that contain all the electrode information needed.

* original labels from edf header
* real electrode names
* coordinates in MNI space
* locations obtained from the atlas

## proc_electrode_pediatric.m
Combine steps from convert positions to MNI space (use a pediatric tempate) to the final matrix.

## mni2fsa.m
Convert MNI152 coordinates to fsaverage coordinates (MNI305) before using `nc_prepare_lay.m` to plot electrodes.

## nc_prepare_lay.m
Plot electrodes on fsaverage pial surface and prepare layout for interactive ploting (`ft_multiplotER and ft_multiplotTFR`).